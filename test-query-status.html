<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Query 状态测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>React Query 状态检测</h1>
    
    <div id="results">
        <p>正在检测...</p>
    </div>

    <script>
        async function checkAllAPIs() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>API 状态检测结果</h2>';
            
            const apis = [
                { name: '健康检查', url: '/api/proxy/system/health' },
                { name: '系统统计', url: '/api/proxy/system/stats' },
                { name: '调度器状态', url: '/api/proxy/system/status' }
            ];
            
            for (const api of apis) {
                try {
                    const response = await fetch(api.url);
                    const data = await response.json();
                    
                    if (response.ok) {
                        results.innerHTML += `
                            <div class="status success">
                                <h3>✓ ${api.name}</h3>
                                <p>状态码: ${response.status}</p>
                                <p>响应时间: ${response.headers.get('x-response-time') || '未知'}</p>
                                <details>
                                    <summary>查看数据</summary>
                                    <pre>${JSON.stringify(data, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    } else {
                        results.innerHTML += `
                            <div class="status error">
                                <h3>✗ ${api.name}</h3>
                                <p>状态码: ${response.status}</p>
                                <p>错误: ${data.message || '未知错误'}</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    results.innerHTML += `
                        <div class="status error">
                            <h3>✗ ${api.name}</h3>
                            <p>网络错误: ${error.message}</p>
                        </div>
                    `;
                }
            }
            
            // 检查主页面的状态
            results.innerHTML += '<h2>主页面状态检查</h2>';
            results.innerHTML += `
                <p>请打开浏览器开发者工具，在主页面 (http://localhost:3000) 的控制台中执行以下代码：</p>
                <pre>
// 检查 React Query 的错误状态
const healthQuery = document.querySelector('[data-testid="health-status"]');
console.log('Health status element:', healthQuery);

// 检查全局错误状态
console.log('Window errors:', window.errors);

// 检查 React 组件状态（如果可访问）
console.log('React DevTools available:', !!window.__REACT_DEVTOOLS_GLOBAL_HOOK__);
                </pre>
            `;
        }

        // 页面加载时自动检测
        window.onload = checkAllAPIs;
    </script>
</body>
</html>